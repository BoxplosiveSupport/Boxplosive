<section class="datapanel">
  <div class="datapanel-heading">
    <h2>4. Discount</h2>
  </div>
  <div class="datapanel-body">
    <div class="form-horizontal">
      <div class="form-group">
        <label class="col-sm-4 control-label required" for="Campaign_Discount_Type" aria-required="true">Discount type</label>
        <div class="col-sm-8">
          <select class="form-control"
                  data-change="forcesave"
                  data-msg-required="The discount type is required."
                  data-rule-required="true"
                  id="Campaign_Discount_Type"
                  name="CampaignDiscountType"
                  type="text"
                  aria-required="true">
            <option value="">Choose a discount type</option>
            <option value="generic" selected>Generic</option>
            <option value="x+1">X + 1</option>
            <option value="percentage">% Discount</option>
            <option value="fixedprice">Fixed Price</option>
          </select>
        </div>
      </div>
    </div>
    <div class="well"
         data-repeatable
         data-orderup="true"
         data-max="3"
         data-msg-max="Maximum of {0} items">
      <div class="form">
        <div class="row">
          <div class="col-sm-8">
            <div class="form-group">
              <input type="search"
                     class="form-control"
                     name="discount.search"
                     data-boxautocomplete="newrepeatable"
                     data-source="ReturnJSON?file=~/Ajax-Stub/products.json"
                     data-minlength="3"
                     data-scrollsteplength="10"
                     data-itemtemplate="#productbrowseritemtemplate" />
              <button type="button" class="form-control-cancel icon-btn icon-cross"></button>
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <button type="button"
                      class="btn btn-default btn-block"
                      data-toggle="modal"
                      data-target="#productbrowser"
                      data-return>Browse product...</button>
            </div>
          </div>
        </div>
      </div>
      <div data-repeatablelist>
        <div class="innerwell" data-repeatableitem>
          <button type="button" class="close" data-action="remove"><span class="sr-only">Remove</span></button>
          <input type="hidden" name="discountrule[0].product.remove" data-removetag />
          <input type="hidden" name="discountrule[0].product.id" value="4321" />
          <div class="form-inline">
            <div class="form-group">
              <div class="input-group inputw-xs" data-boxspinner>
                <input type="number"
                       id="discountrule[0]_product_number"
                       name="discountrule[0].product.number"
                       class="form-control"
                       min="0"
                       data-msg-integer="Integer required"
                       data-rule-integer="true"
                       data-msg-required="Required."
                       required />
              </div>
              <span class="form-control-static">x</span>
              <strong class="form-control-static">Test</strong>
            </div>
          </div>
          <br class="hidden-xs"/>
          <div class="form-inline">
            <div class="form-group">
              <div class="input-group inputw-xs" data-boxspinner>
                <input type="number"
                       id="discountrule[0]_discount_number"
                       name="discountrule[0].discount.number"
                       class="form-control"
                       min="0"
                       data-msg-integer="Integer required"
                       data-rule-integer="true"
                       data-msg-required="Required."
                       data-rule-required="true"
                       required />
              </div>
              <span class="form-control-static">x</span>
            </div>
            <div class="form-group">
              <input type="number"
                     id="discountrule[0]_discount_amount"
                     name="discountrule[0].discount.amount"
                     class="form-control inputw-xxs"
                     min="0"
                     data-msg-required="Required."
                     data-rule-required="true"
                     required />
            </div>
            <div class="form-group">
              <select class="form-control inputw-xxs"
                      id="discountrule[0]_discount_type"
                      name="discountrule[0].discount.type">
                <option value="percentage">%</option>
                <option value="cents">Cents</option>
              </select>
              <span class="form-control-static">Discount</span>
            </div>
          </div>
        </div>
      </div>
      <div class="form">
        <div class="checkbox">
          <label>
            <input type="checkbox" name="Campaign.Repeatable.Discount"> Repeatable discount
          </label>
        </div>
      </div>
      <script type="text/mustache" data-template>
        <div class="innerwell" data-repeatableitem>
          <button type="button" class="close" data-action="remove"><span class="sr-only">Remove</span></button>
          <input type="hidden" name="discountrule[{{index}}].product.remove" data-removetag />
          <input type="hidden" name="discountrule[{{index}}].product.id" value="{{id}}" />
          <div class="form-inline">
            <div class="form-group">
              <div class="input-group inputw-xs" data-boxspinner>
                <input type="number"
                       id="discountrule[{{index}}]_product_number"
                       name="discountrule[{{index}}].product.number"
                       class="form-control"
                       min="0"
                       data-msg-integer="Integer required"
                       data-rule-integer="true"
                       data-msg-required="Required."
                       required />
              </div>
            </div>
            <span class="form-control-static">x</span>
            <strong class="form-control-static">{{{label}}}</strong>
          </div>
          <br class="hiddex-xs" />
          <div class="form-inline">
            <div class="form-group">
              <div class="input-group inputw-xs" data-boxspinner>
                <input type="number"
                       id="discountrule[{{index}}]_discount_number"
                       name="discountrule[{{index}}].discount.number"
                       class="form-control"
                       min="0"
                       data-msg-integer="Integer required"
                       data-rule-integer="true"
                       data-msg-required="Required."
                       data-rule-required="true"
                       required />
              </div>
            </div>
            <span class="form-control-static">x</span>
            <div class="form-group">
              <input type="number"
                     id="discountrule[{{index}}]_discount_amount"
                     name="discountrule[{{index}}].discount.amount"
                     class="form-control inputw-xxs"
                     min="0"
                     data-msg-required="Required."
                     data-rule-required="true"
                     required />
            </div>
            <div class="form-group">
              <select class="form-control inputw-xxs"
                      id="discountrule[{{index}}]_discount_type"
                      name="discountrule[{{index}}].discount.type">
                <option value="percentage">%</option>
                <option value="cents">Cents</option>
              </select>
              <span class="form-control-static">Discount</span>
            </div>
          </div>
        </div>
      </script>
    </div>
    <button type="submit" class="btn btn-primary" data-action="save">Save</button>
    <button type="submit" class="btn btn-primary" data-action="saveandeditnext">Save and next</button>
  </div>
</section>

<div class="modal fade browser"
     id="productbrowser"
     tabindex="-1"
     role="dialog"
     aria-labelledby="productbrowser"
     aria-hidden="true"
     data-browsermodal="singleselect">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span class="sr-only">Close</span></button>
        <h4 class="modal-title">Browse products</h4>
      </div>
      <div class="modal-body">
        <div class="row form">
          <div class="col-sm-6">
            <div class="form-group">
              <input type="search"
                     class="form-control"
                     name="productgroupfilter"
                     id="productgroupfilter"
                     placeholder="Find product group..."
                     data-boxautocomplete
                     data-source="ReturnJSON?file=~/Ajax-Stub/products.json"
                     data-minlength="0"
                     data-appendto="#productgroupresult"
                     data-scrollsteplength="10"
                     data-browserentry="true"
                     data-sub="#productfilter"
                     data-disableselect="true"
                     data-itemtemplate="#productbrowseritemtemplate">
              <button type="button" class="form-control-cancel icon-btn icon-cross"></button>
            </div>
            <div class="result" id="productgroupresult">

            </div>
          </div>
          <div class="col-sm-6">
            <div class="form-group">
              <input type="search"
                     class="form-control"
                     name="productfilter"
                     id="productfilter"
                     placeholder="Find product in product group"
                     data-boxautocomplete
                     data-source="ReturnJSON?file=~/Ajax-Stub/subproducts.json"
                     data-minlength="0"
                     data-appendto="#productresult"
                     data-scrollsteplength="10"
                     data-super="#productgroupfilter"
                     data-itemtemplate="#productbrowseritemtemplate"
                     disabled>
              <button type="button" class="form-control-cancel icon-btn icon-cross"></button>
            </div>
            <div class="result" id="productresult">

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/mustache" id="productbrowseritemtemplate">
  <li>
    {{#folder}}<span class="icon icon-folder"></span>{{/folder}}
    {{#label}}<span class="labeltext">{{label}}</span>{{/label}}
    {{#sublabel}}<small tabindex="0">{{sublabel}}</small>{{/sublabel}}
  </li>
</script>